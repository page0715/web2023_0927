<!DOCTYPE html>
<html lang="en">

<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>

  </style>
</head>

<body>
  <div class="container-fluid mt-3">
    <h2>計算機</h2>
    <p>JQuery..來做</p>
    <table class="table table-hover align-middle text-center">
      <thead>
        <tr>
          <th>Num1</th>
          <th>Num2</th>
          <th>Option(+-*/)</th>
          <th>button</th>
          <th>result</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <input type="number" class="form-control my-num1" name="" id="item1Num1" value="100">
          </td>
          <td>
            <input type="number" class="form-control my-num2" name="" id="item1Num2" value="100">
          </td>
          <td>
            <select>
              <option>請選擇option</option>
              <option>+</option>
              <option>-</option>
              <option>*</option>
              <option>/</option>
          </select>
          </td>
          <td>
            <input type="button" class="btn btn-primary"  name="" id="" value="=">
          </td>
          <td>
            <input type="number" class="form-control my-total" name="" id="item1Total" value="100" readonly>
          </td>
        </tr>
        <!-- <tr>
          <td>
            <img src="https://picsum.photos/id/25/160/120" alt="" srcset="">
          </td>
          <td>
            <input type="number" class="form-control my-price" name="" id="item1Price" value="200">
          </td>
          <td>
            <input type="number" class="form-control my-num" name="" id="item1Num" value="1">
          </td>
          <td>
            <input type="number" class="form-control my-total" name="" id="item1Total" value="200" readonly>
          </td>
        </tr> -->
        <tr>
          <td colspan="4">
            <span id="resultSpan"></span>
          </td>
        </tr>

      </tbody>
    </table>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    $(document).ready(function () {

      function sumFun() {
        let sum = 0;
        myTotal.each(function (index, element) {
          console.log('index', index);
          console.log('element', element);
          console.log('this', this);
          let getValue = Number($(this).val());
          console.log('getValue', getValue);
          sum += getValue;
        });
        console.log('sum', sum);
        if (sum >= 500) {
          result = sum * 0.8;
          resultText = `恭喜您 打八折 ${result}`;
          resultSpan.attr('class', 'text-danger');
        } else {
          resultText = sum;
          resultSpan.attr('class', '');
        }
        resultSpan.text(resultText);
      }

      // 綁定

      const myPrice = $('.my-price');
      const myNum1 =$('.my-num1')
      const myNum2 = $('.my-num2');
      const myTotal = $('.my-total');
      const resultSpan = $('#resultSpan');

      // item1Price.val('123');
      console.log('myPrice', myPrice);
      console.log('myNum1', myNum1);
      console.log('myNum2', myNum2);
      console.log('myTotal', myTotal);
      // console.log('myTotal[0]', myTotal[0]);
      // console.log('myTotal[1]', myTotal[1]);

      // init 初始化
      sumFun();

      myNum.change(function () {

        // console.log('this', this);
        // console.log('$(this)', $(this));
        // console.log('$(this).parent()', $(this).parent());
        // console.log('$(this).parent().parent()', $(this).parent().parent());
        // console.log('$(this).parent().parent().find(".my-price")', $(this).parent().parent().find('.my-price'));

        // jq parent() 找上一層
        // jq find() 往內找第一個

        let trObj = $(this).parent().parent();
        let nowPrice = trObj.find('.my-price');
        let nowNum = trObj.find('.my-num');
        let nowTotal = trObj.find('.my-total');

        console.log('trObj', trObj);
        console.log('nowPrice', nowPrice);
        console.log('nowNum', nowNum);
        console.log('nowTotal', nowTotal);

        let getPrice = Number(nowPrice.val());
        let getNum = Number(nowNum.val());
        let resultTotal = getPrice * getNum;
        nowTotal.val(resultTotal);
        // console.log('getItem1Price', getItem1Price);
        // console.log('typeof', typeof (getItem1Price));

        // change時重新呼叫
        sumFun();
      });
    });

  </script>
</body>

</html>